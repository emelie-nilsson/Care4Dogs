{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2>{{ post.title }}</h2>

  {% if post.image %}
  <img
    src="{{ post.image.url }}"
    alt="Bild fÃ¶r {{ post.title }}"
    class="img-fluid mb-3 post-image"
  />
  {% endif %}

  <p>{{ post.content|linebreaks }}</p>
  <p class="text-muted fst-italic small">ğŸ“… From: {{ post.date_from|date:"Y-m-d" }}</p>
  <p class="text-muted fst-italic small">ğŸ“… To: {{ post.date_to|date:"Y-m-d" }}</p>

  <p class="text-muted fst-italic small">
    ğŸ¾ Posted by {{ post.user.username }} on {{ post.date_posted|date:"Y-m-d H:i" }}
  </p>

  {% if post.last_updated != post.date_posted %}
  <p class="text-muted fst-italic small">
    âœï¸ Last updated: {{ post.last_updated|date:"Y-m-d H:i" }}
  </p>
  {% endif %}

  <!-- Back + Edit/Delete -->
  <div class="d-flex justify-content-between align-items-center mt-4 mb-3 flex-wrap">
    <a href="{% url 'post_list' %}" class="btn btn-primary mb-2">Back to Posts</a>

    {% if user == post.user %}
    <div class="text-end">
      <a href="{% url 'post_edit' post.id %}" class="btn btn-outline-secondary me-2">Edit</a>
      <a href="{% url 'post_delete' post.id %}" class="btn btn-outline-danger">Delete</a>
    </div>
    {% endif %}
  </div>

  <hr>

  <!-- List of comments -->
  <h5>Comments ({{ comments.count }})</h5>
  {% for comment in comments %}
    <div class="comment-box">
      <strong>{{ comment.user.username }}</strong>
      <small class="text-muted">{{ comment.created_at|date:"Y-m-d H:i" }}</small>
      <p>{{ comment.content|linebreaks }}</p>
    </div>
  {% endfor %}

  <!-- Comment form-->
  {% if user.is_authenticated %}
  <form method="POST" action="" class="d-flex flex-column flex-md-row align-items-start gap-3">
    {% csrf_token %}

    <div class="flex-grow-1 w-100">
      {{ form.content }}
      {% if form.content.errors %}
        <div class="text-danger">{{ form.content.errors }}</div>
      {% endif %}
    </div>

    <div class="d-flex flex-column align-items-center">
      <button type="submit" class="btn btn-primary mb-2">Post Comment</button>

      <!-- Like -->
      <form action="{% url 'post_like' post.id %}" method="POST">
        {% csrf_token %}
        <button type="submit" class="btn btn-link like-button {% if liked %}liked{% else %}not-liked{% endif %}" title="Like">
          â™¥
        </button>
        <span>{{ total_likes }}</span>
      </form>
    </div>
  </form>
  {% else %}
  <p><a href="{% url 'login' %}">Log in</a> to like and comment.</p>
  {% endif %}
</div>
{% endblock %}
